<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tabela SeleÃ§Ã£o</title>

<style>
body {
  margin: 0;
  padding-top: 70px;
  font-family: Arial, sans-serif;
}

.topo {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: #222;
  color: #fff;
  display: flex;
  justify-content: space-around;
  padding: 12px;
  font-size: 18px;
  z-index: 1000;
}

.marcado {
  background: #4caf50;
  color: #fff;
}

table {
  width: 100%;
  border-collapse: collapse;
}

td {
  border: 1px solid #ccc;
  padding: 12px;
  text-align: center;
  cursor: pointer;
  user-select: none;
}
</style>
</head>

<body>

<div class="topo">
  <div>Marcados: <span id="marcados">0</span></div>
  <div>Faltam: <span id="faltam">0</span></div>
</div>

<table id="tabela"></table>

<script type="module">
/* ðŸ”¥ FIREBASE */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAzIGJub68rmKIt1Qzsc9Aygbd1IeHF4kY",
  authDomain: "tabela-selecao.firebaseapp.com",
  projectId: "tabela-selecao",
  storageBucket: "tabela-selecao.firebasestorage.app",
  messagingSenderId: "182647940029",
  appId: "1:182647940029:web:393aec06b26187c01828d4"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ref = doc(db, "estado", "selecionados");

/* ðŸ“Š TABELA */
const TOTAL = 316;
const SOMA_TOTAL = TOTAL * (TOTAL + 1) / 2;

const tabela = document.getElementById("tabela");
const marcadosSpan = document.getElementById("marcados");
const faltamSpan = document.getElementById("faltam");

let selecionados = new Set();

/* ðŸ”„ CARREGAR DADOS */
async function carregar() {
  const snap = await getDoc(ref);
  if (snap.exists()) {
    selecionados = new Set(snap.data().itens || []);
  }
  montarTabela();
}

/* ðŸ’¾ SALVAR AUTOMATICAMENTE */
async function salvar() {
  await setDoc(ref, { itens: [...selecionados] });
}

/* ðŸ§± MONTAR TABELA */
function montarTabela() {
  tabela.innerHTML = "";
  let linha;

  for (let i = 1; i <= TOTAL; i++) {
    if ((i - 1) % 10 === 0) linha = tabela.insertRow();

    const td = linha.insertCell();
    td.textContent = i;

    if (selecionados.has(i)) td.classList.add("marcado");

    td.onclick = () => {
      if (selecionados.has(i)) {
        selecionados.delete(i);
        td.classList.remove("marcado");
      } else {
        selecionados.add(i);
        td.classList.add("marcado");
      }
      atualizar();
      salvar();
    };
  }

  atualizar();
}

/* âž• SOMAS */
function atualizar() {
  const somaMarcados = [...selecionados].reduce((a, b) => a + b, 0);
  marcadosSpan.textContent = somaMarcados;
  faltamSpan.textContent = SOMA_TOTAL - somaMarcados;
}

carregar();
</script>

</body>
</html>
