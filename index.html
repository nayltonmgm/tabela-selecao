<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Projeto Cofinho</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }

  h1 {
    margin-bottom: 5px;
  }

  .saldo {
    font-size: 28px;
    font-weight: bold;
    color: #2ecc71; /* mesma cor dos marcados */
    margin-bottom: 15px;
  }

  button {
    padding: 6px 10px;
    cursor: pointer;
  }

  .container {
    display: flex;
    gap: 20px;
  }

  .backups {
    width: 260px;
    border: 1px solid #ccc;
    padding: 10px;
  }

  .backups h3 {
    margin-top: 0;
  }

  .backup-item {
    font-size: 14px;
    border-bottom: 1px solid #eee;
    padding: 6px 0;
  }

  input {
    padding: 6px;
    width: 120px;
  }
</style>
</head>

<body>

<h1>Projeto Cofinho</h1>
<div class="saldo" id="saldo">Saldo: R$ 0</div>

<input id="valor" type="number" placeholder="Valor">
<button onclick="salvar()">Adicionar</button>

<div class="container">
  <div class="backups">
    <h3>ðŸ•’ Ãšltimas alteraÃ§Ãµes</h3>
    <div id="listaBackups"></div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import {
    getDatabase,
    ref,
    set,
    push,
    onValue,
    query,
    limitToLast
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBvpZWh-4VCHvEpo3RX-z774U_SYEO7auE",
    authDomain: "cofre-7651a.firebaseapp.com",
    databaseURL: "https://cofre-7651a-default-rtdb.firebaseio.com",
    projectId: "cofre-7651a",
    storageBucket: "cofre-7651a.firebasestorage.app",
    messagingSenderId: "836207545752",
    appId: "1:836207545752:web:03e1602fbb038a0c2e6fed"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let saldoAtual = 0;

  // Atualiza saldo em tempo real
  onValue(ref(db, "saldo"), snap => {
    saldoAtual = snap.val() || 0;
    document.getElementById("saldo").innerText =
      "Saldo: R$ " + saldoAtual.toFixed(2);
  });

  // Lista apenas os 5 Ãºltimos backups
  const backupsQuery = query(ref(db, "backups"), limitToLast(5));

  onValue(backupsQuery, snap => {
    const lista = document.getElementById("listaBackups");
    lista.innerHTML = "";

    if (!snap.exists()) return;

    const dados = Object.values(snap.val()).reverse();

    dados.forEach(b => {
      const div = document.createElement("div");
      div.className = "backup-item";
      div.innerHTML = `
        <strong>R$ ${b.saldo.toFixed(2)}</strong><br>
        <small>${b.data}</small>
      `;
      lista.appendChild(div);
    });
  });

  // Salvar valor
  window.salvar = function () {
    const valor = Number(document.getElementById("valor").value);
    if (!valor) return;

    const novoSaldo = saldoAtual + valor;

    set(ref(db, "saldo"), novoSaldo);

    push(ref(db, "backups"), {
      saldo: novoSaldo,
      valorAdicionado: valor,
      data: new Date().toLocaleString("pt-BR")
    });

    document.getElementById("valor").value = "";
  };
</script>

</body>
</html>
