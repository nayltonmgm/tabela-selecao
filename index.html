<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Projeto 50K</title>

<style>
body {
  margin: 0;
  padding-top: 210px;
  font-family: Arial, sans-serif;
}

/* TOPO FIXO */
.topo {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: #222;
  color: #fff;
  padding: 10px;
  z-index: 1000;
}

.titulo {
  text-align: center;
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 8px;
}

/* INFO EM COLUNAS */
.topo-conteudo {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 6px;
  font-size: 14px;
}

.box {
  background: #333;
  padding: 6px;
  border-radius: 6px;
  text-align: center;
}

.marcado {
  background: #4caf50;
  color: #fff;
  padding: 2px 6px;
  border-radius: 4px;
}

/* PROGRESSO */
.progresso-container {
  margin-top: 10px;
}

.barra {
  width: 100%;
  height: 16px;
  background: #444;
  border-radius: 8px;
  overflow: hidden;
}

.barra-preenchida {
  height: 100%;
  width: 0%;
  background: #4caf50;
  transition: width 0.3s;
}

.percentual {
  text-align: center;
  font-size: 13px;
  margin-top: 4px;
}

/* TABELA */
table {
  width: 100%;
  border-collapse: collapse;
}

td {
  border: 1px solid #ddd;
  padding: 10px 0;
  text-align: center;
  cursor: pointer;
  user-select: none;
  font-size: 14px;
}

td.marcado {
  background: #4caf50;
  color: #fff;
  font-weight: bold;
}

/* DESKTOP */
@media (min-width: 768px) {
  body {
    padding-top: 160px;
  }

  .topo-conteudo {
    grid-template-columns: repeat(4, 1fr);
    font-size: 16px;
  }

  td {
    font-size: 16px;
    padding: 12px;
  }
}
</style>
</head>

<body>

<div class="topo">
  <div class="titulo">Projeto 50K</div>

  <div class="topo-conteudo">
    <div class="box">Saldo<br><span id="saldo" class="marcado">R$ 0,00</span></div>
    <div class="box">Faltam<br><span id="faltam">R$ 0,00</span></div>
    <div class="box">Depósitos<br><strong id="qtdMarcados">0</strong></div>
    <div class="box">Restam<br><strong id="qtdRestam">0</strong></div>
  </div>

  <div class="progresso-container">
    <div class="barra">
      <div class="barra-preenchida" id="barra"></div>
    </div>
    <div class="percentual" id="percentual">0% concluído</div>
  </div>
</div>

<table id="tabela"></table>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAzIGJub68rmKIt1Qzsc9Aygbd1IeHF4kY",
  authDomain: "tabela-selecao.firebaseapp.com",
  projectId: "tabela-selecao",
  storageBucket: "tabela-selecao.firebasestorage.app",
  messagingSenderId: "182647940029",
  appId: "1:182647940029:web:393aec06b26187c01828d4"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ref = doc(db, "estado", "selecionados");

const TOTAL = 316;
const SOMA_TOTAL = TOTAL * (TOTAL + 1) / 2;

const tabela = document.getElementById("tabela");
const saldoSpan = document.getElementById("saldo");
const faltamSpan = document.getElementById("faltam");
const qtdMarcadosSpan = document.getElementById("qtdMarcados");
const qtdRestamSpan = document.getElementById("qtdRestam");
const barra = document.getElementById("barra");
const percentualSpan = document.getElementById("percentual");

let selecionados = new Set();

async function carregar() {
  const snap = await getDoc(ref);
  if (snap.exists()) {
    selecionados = new Set(snap.data().itens || []);
  }
  montarTabela();
}

async function salvar() {
  await setDoc(ref, { itens: [...selecionados] });
}

function formatarBR(valor) {
  return valor.toLocaleString("pt-BR", {
    style: "currency",
    currency: "BRL"
  });
}

function montarTabela() {
  tabela.innerHTML = "";
  let linha;

  for (let i = 1; i <= TOTAL; i++) {
    if ((i - 1) % 10 === 0) linha = tabela.insertRow();

    const td = linha.insertCell();
    td.textContent = `R$ ${i}`;

    if (selecionados.has(i)) td.classList.add("marcado");

    td.onclick = () => {
      selecionados.has(i)
        ? selecionados.delete(i)
        : selecionados.add(i);

      td.classList.toggle("marcado");
      atualizar();
      salvar();
    };
  }

  atualizar();
}

function atualizar() {
  const soma = [...selecionados].reduce((a, b) => a + b, 0);
  const faltam = SOMA_TOTAL - soma;

  const qtdMarcados = selecionados.size;
  const percentual = (qtdMarcados / TOTAL) * 100;

  saldoSpan.textContent = formatarBR(soma);
  faltamSpan.textContent = formatarBR(faltam);

  qtdMarcadosSpan.textContent = qtdMarcados;
  qtdRestamSpan.textContent = TOTAL - qtdMarcados;

  barra.style.width = percentual + "%";
  percentualSpan.textContent = percentual.toFixed(1) + "% concluído";
}

carregar();
</script>

</body>
</html>
